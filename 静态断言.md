# 静态断言

## assert

assert的作用是先计算表达式expression,如果其值为假（值为0），那么它先想stderr打印出一条错误的信息，然后通过调用abort来终止程序运行。

assert分为动态断言和静态断言。

## 静态断言

C++0x引入static_assert，**用来实现编译期间的断言，叫静态断言。**

- 语法

```c++
static_assert(常量表达式，要提示的字符串);
```

- 解析
  - 如果第一个参数常量表达式的值为false，会产生一条编译错误，那么错误位置就是在static_assert语句的所在行，第二个参数就是错误提示字符串。
  - 然后通过abort来终止程序运行。
- 编译器在遇到一个static_assert语句时，通常立刻将其第一个参数作为常量表达式进行演算，但如果该常量表达式依赖于某些模板参数，**则延迟到模版实例化时再进行演算**，这就让检查模板参数成为了可能。
- 性能
  - 由于是static_assert编译期间断言，不生成目标代码，因此static_assert不会造成任何运行期间的性能损失。
- 简单的例子

```c++
static_assert(sizeof(void *) == 4,"64位系统不支持");
```

## 动态断言

- assert是运行期的判断，并且会强制终止程序，一般要求只能用于debug版本中，是为了尽可能块的发现问题，assert要从release的版本中去掉。
- 所以一般开发会重新定义assert宏。

## 两者比较

- 静态断言在编译时进行处理，不会产生任何时刻空间和时间上的开销，这就使得它比assert宏具有更好的效率，另外比较重要的一个特性是如果断言失败，它会产生有意义且充分的诊断信息，帮助程序员快速解决问题。

